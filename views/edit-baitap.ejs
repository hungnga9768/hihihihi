<%- include('header') %>
<%- include('aside') %>

<div class="content-wrapper">
  <section class="content-header">
    <h1><%= title %></h1>
  </section>

  <section class="content">
    <div class="box">
      <div class="box-body card card-primary">
        <div class="card">
          <div class="card-header">T·∫°o B√†i T·∫≠p L·ªõn & Danh S√°ch C√¢u H·ªèi</div>
          <div class="card-body">

            <!-- Form T·∫°o/S·ª≠a B√†i T·∫≠p L·ªõn -->
            <form method="POST" action="/admin/baitap/edit/<%= baitap.exercise_set_id%>">
              <div class="form-group">
                <label for="lesson_id">bai hoc</label>
                <select
                  class="form-control"
                  id="lesson_id"
                  name="lesson_id"
                  required
                >
                  <% baihoc.forEach(function(data) { %>
                  <option value="<%= data.lesson_id %>"
                    <%= (data.lesson_id === baitap.lesson_id) ? 'selected' : '' %>>
                    <%= data.title %>
                  </option>
                  <% }) %>
                </select>
              </div>

              <div class="form-group">
                <label for="title">Ti√™u ƒë·ªÅ</label>
                <input type="text" class="form-control" name="title" value="<%= baitap.title %>" required>
              </div>

              <div class="form-group">
                <label for="description">M√¥ t·∫£</label>
                <textarea class="form-control" name="description"><%= baitap.description %></textarea>
              </div>

              <button type="submit" class="btn btn-primary">L∆∞u B√†i T·∫≠p L·ªõn</button>
            </form>
            <div class="container-fluid">
              <div class="row">
                <div class="col-md-12">
                  <h4 class="mb-4"> Danh s√°ch c√¢u h·ªèi trong b√†i t·∫≠p: "<%= baitap.title %>"</h4>
            
                  <% listcauhoi.forEach((cauhoi, index) => {
                    let options = [];
                    try { options = JSON.parse(cauhoi.options); } catch (e) {}
                  %>
                    <div class="card mb-4">
                      <div class="card-header bg-primary text-white">
                        <strong>C√¢u <%= index + 1 %> - 
                          <%= cauhoi.exercise_type === 'multiple_choice' ? 'Tr·∫Øc nghi·ªám' :
                              cauhoi.exercise_type === 'fill_blank' ? 'ƒêi·ªÅn ch·ªó tr·ªëng' :
                              cauhoi.exercise_type === 'matching' ? 'Gh√©p ƒë√¥i' : 'Vi·∫øt' %>
                        </strong>
                      </div>
                      <div class="card-body">
                        <p><strong>C√¢u h·ªèi:</strong> <%= cauhoi.question %></p>
            
                        <% if (cauhoi.exercise_type === 'multiple_choice' && options.length > 0) { %>
                          <ul class="list-group mb-3">
                            <% options.forEach((opt, i) => { %>
                              <li class="list-group-item">
                                <strong><%= String.fromCharCode(65 + i) %>.</strong> <%= opt %>
                              </li>
                            <% }) %>
                          </ul>
                        <% } else if (cauhoi.exercise_type === 'fill_blank') { %>
                          <p class="text-muted"><em>(Ng∆∞·ªùi h·ªçc s·∫Ω ƒëi·ªÅn t·ª´ v√†o ch·ªó tr·ªëng)</em></p>
                        <% } else if (cauhoi.exercise_type === 'matching') { %>
                          <p class="text-muted"><em>(Hi·ªÉn th·ªã c·∫∑p gh√©p d·ª±a v√†o d·ªØ li·ªáu JSON)</em></p>
                        <% } else if (cauhoi.exercise_type === 'writing') { %>
                          <p class="text-muted"><em>(Ng∆∞·ªùi h·ªçc s·∫Ω vi·∫øt c√¢u tr·∫£ l·ªùi)</em></p>
                        <% } %>
            
                        <p><strong> ƒê√°p √°n ƒë√∫ng:</strong> <%= cauhoi.correct_answer %></p>
            
                        <% if (cauhoi.explanation) { %>
                          <p><strong> Gi·∫£i th√≠ch:</strong> <%= cauhoi.explanation %></p>
                        <% } %>
                      </div>
                      <form method="POST" action="/admin/baitap/cauhoi/delete/<%= cauhoi.exercise_id %>" onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën xo√° c√¢u h·ªèi n√†y?')" style="display:inline;">
                        <button type="submit" class="btn btn-sm btn-danger">Xo√°</button>
                      </form>
                      
                    </div>
                  <% }) %>
                </div>
              </div>
            </div>
            
            <hr />
            <h4>‚ûï Th√™m C√¢u H·ªèi M·ªõi Cho B√†i T·∫≠p: "<%= baitap.title %>"</h4>
              <form method="POST" action="/admin/baitap/cauhoi/add">
  <input type="hidden" name="exercise_set_id" value="<%= baitap.exercise_set_id %>">

  <div class="form-group">
    <label>Lo·∫°i c√¢u h·ªèi</label>
    <select name="exercise_type" class="form-control" required>
      <option value="multiple_choice">Tr·∫Øc nghi·ªám</option>
      <option value="fill_blank">ƒêi·ªÅn v√†o ch·ªó tr·ªëng</option>
      <option value="matching">Gh√©p ƒë√¥i</option>
      <option value="writing">Vi·∫øt</option>
    </select>
  </div>

  <div class="form-group">
    <label>C√¢u h·ªèi</label>
    <textarea name="question" class="form-control" rows="3" required></textarea>
  </div>

  <div class="form-group">
    <label>ƒê√°p √°n ƒë√∫ng</label>
    <input type="text" name="correct_answer" class="form-control" required>
  </div>

  <!-- C√°c l·ª±a ch·ªçn: Option A -> D -->
  <div class="form-group">
    <label>L·ª±a ch·ªçn A</label>
    <input type="text" name="optionA" class="form-control">
  </div>
  <div class="form-group">
    <label>L·ª±a ch·ªçn B</label>
    <input type="text" name="optionB" class="form-control">
  </div>
  <div class="form-group">
    <label>L·ª±a ch·ªçn C</label>
    <input type="text" name="optionC" class="form-control">
  </div>
  <div class="form-group">
    <label>L·ª±a ch·ªçn D</label>
    <input type="text" name="optionD" class="form-control">
  </div>

  <div class="form-group">
    <label>Gi·∫£i th√≠ch</label>
    <textarea name="explanation" class="form-control" rows="2"></textarea>
  </div>

  <button type="submit" class="btn btn-success">üíæ L∆∞u C√¢u H·ªèi</button>
                </form>

          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<%- include('footer') %>
